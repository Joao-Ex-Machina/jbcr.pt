{{ define "main" }}
<h1>{{ .Title }}</h1>

<div class="page-description">
  {{ .Content }}
</div>

<!-- Tag filters -->
<div id="tag-filters">
  <button data-tag="all" class="active">All</button>
  {{ $allTags := slice }}
  {{ range site.Data.photos.analog }}
    {{ range .tags }}
      {{ if not (in $allTags .) }}
        {{ $allTags = $allTags | append . }}
      {{ end }}
    {{ end }}
  {{ end }}
  {{ range $allTags }}
    <button data-tag="{{ . }}">{{ . }}</button>
  {{ end }}
</div>

<!-- Gallery grid -->
<div class="masonry-gallery" id="photo-gallery">
  {{ range site.Data.photos.analog }}
    <div class="masonry-item" data-tags='{{ if .tags }}{{ delimit .tags " " }}{{ end }}'>
      <a href="/photos/analog/{{ .filename }}" class="glightbox" data-title='
        <div class="photo-info">
          <strong>{{ .title }}</strong><br>
          {{ .camera }} | {{ .film }} | {{ .album }} | {{ .date }}
        </div>
      '>
        <img src="/photos/analog/{{ .filename }}" alt="{{ .title }}" loading="lazy">
      </a>
    </div>
  {{ end }}
</div>
<!-- GLightbox CSS & JS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css">
<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>

<script>
// Initialize Lightbox
const lightbox = GLightbox({ selector: '.glightbox' });

// Tag filtering
const buttons = document.querySelectorAll('#tag-filters button');
const items = document.querySelectorAll('.masonry-item');

buttons.forEach(btn => {
  btn.addEventListener('click', () => {
    buttons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const tag = btn.dataset.tag;

    items.forEach(item => {
      const tags = item.dataset.tags.split(" ");
      item.style.display = (tag === "all" || tags.includes(tag)) ? 'block' : 'none';
    });
  });
});
</script>

<style>
/* Masonry */
.masonry-gallery {
  column-count: 3;   /* number of columns */
  column-gap: 16px;
}

.masonry-item {
  break-inside: avoid;
  margin-bottom: 16px;
}

.masonry-item img {
  width: 100%;
  height: auto;
  border-radius: 8px;
  cursor: pointer;
  transition: transform 0.3s;
}
.glightbox-clean .gdesc-inner {
  padding: 2px 10px;     /* less padding inside the box */
}
.photo-info {
  font-size: 0.9rem;      /* smaller than default */
  line-height: 1.2;
  color: #eee;             /* light color for dark lightbox */
}
/* Tag buttons */
#tag-filters {
  margin-bottom: 16px;
}
#tag-filters button {
  margin: 4px;
  padding: 6px 12px;
  border: none;
  background: #ddd;
  cursor: pointer;
  border-radius: 4px;
}
#tag-filters button.active {
  background: #333;
  color: white;
}
</style>

{{ end }}
